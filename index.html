<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TaaPlay — Early Access Waitlist</title>
<link rel="stylesheet" href="styles.css" />
<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background-color: #0a0a0a;
    color: #fff;
  }
  header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
  }
  header h1 {
    margin: 0;
    font-size: 1.5rem;
    color: #fff;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding-top: 6rem;
    padding-bottom: 4rem;
    min-height: 100vh;
    position: relative;
    z-index: 1;
  }
  video.bg-video {
    position: fixed;
    top: 0;
    left: 0;
    min-width: 100%;
    min-height: 100%;
    object-fit: cover;
    z-index: -1;
    filter: brightness(0.5);
  }
  form {
    background-color: rgba(0,0,0,0.6);
    padding: 1.5rem;
    border-radius: 8px;
    max-width: 400px;
    width: 100%;
  }
  form input, form select, form textarea {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
    background: transparent;
    border: 1px solid #ff6f61;
    border-radius: 4px;
    color: #fff;
  }
  form button {
    width: 100%;
    padding: 0.75rem;
    background-color: #ff6f61;
    color: #fff;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
  }
  form button:hover {
    background-color: #ff8a75;
  }
  #form-response {
    margin-top: 0.75rem;
    font-size: 0.9rem;
    min-height: 1.25rem;
  }
  footer {
    padding: 1rem;
    text-align: center;
    background-color: rgba(0,0,0,0.5);
  }
  footer a {
    color: #ff6f61;
    text-decoration: none;
  }
</style>
</head>
<body>

<video class="bg-video" autoplay muted loop playsinline>
  <source src="assets/bg-video.mp4" type="video/mp4" />
</video>

<header>
  <h1>TaaPlay</h1>
</header>

<main>
  <h2>Join the Early Access Waitlist</h2>
  <form id="early-access" action="https://app.convertkit.com/forms/8440980/subscriptions" method="post">
    <input type="email" name="email_address" placeholder="Email address" required />
    <select name="fields[role]" required>
      <option value="">Select your role</option>
      <option value="ECD practitioner/teacher">ECD practitioner/teacher</option>
      <option value="Parent/caregiver">Parent/caregiver</option>
      <option value="Centre owner/principal">Centre owner/principal</option>
      <option value="NGO/programme manager">NGO/programme manager</option>
      <option value="Other">Other</option>
    </select>
    <select name="fields[province]" required>
      <option value="">Select your province</option>
      <option value="Eastern Cape">Eastern Cape</option>
      <option value="Free State">Free State</option>
      <option value="Gauteng">Gauteng</option>
      <option value="KwaZulu-Natal">KwaZulu-Natal</option>
      <option value="Limpopo">Limpopo</option>
      <option value="Mpumalanga">Mpumalanga</option>
      <option value="Northern Cape">Northern Cape</option>
      <option value="North West">North West</option>
      <option value="Western Cape">Western Cape</option>
    </select>
    <select name="fields[preferred_language]" required>
      <option value="">Preferred language</option>
      <option value="Afrikaans">Afrikaans</option>
      <option value="English">English</option>
      <option value="isiNdebele">isiNdebele</option>
      <option value="isiXhosa">isiXhosa</option>
      <option value="isiZulu">isiZulu</option>
      <option value="Sepedi">Sepedi</option>
      <option value="Sesotho">Sesotho</option>
      <option value="Setswana">Setswana</option>
      <option value="siSwati">siSwati</option>
      <option value="Tshivenda">Tshivenda</option>
      <option value="Xitsonga">Xitsonga</option>
    </select>
    <textarea name="fields[top_need]" placeholder="Your top need (optional)"></textarea>
    <label style="display:block; text-align:left; font-size:0.85rem;">
      <input type="checkbox" name="fields[consent]" required /> I agree to receive early access updates and related ECD resources.
    </label>
    <input type="text" id="taaplay_hp" name="hp_field" style="display:none;" tabindex="-1" autocomplete="off" />
    <button type="submit">Join the Waitlist</button>
    <div id="form-response" class="help" role="status" aria-live="polite"></div>
  </form>
</main>

<footer>
  <p><a href="privacy.html">Privacy Notice</a></p>
</footer>

<script>
(function(){
  const FORM_ID = '8440980';
  const PUBLIC_API_KEY = 'iXp-HxhQ1KWoVaP5hOz6cg';
  const ENDPOINT = `https://api.convertkit.com/v3/forms/${encodeURIComponent(FORM_ID)}/subscribe`;

  const form = document.getElementById('early-access');
  const resp = document.getElementById('form-response');
  if (!form || !resp) return;

  function track(event, props){ try { window.plausible && window.plausible(event, { props }); } catch(_){} }

  const pageLoadAt = Date.now();
  const hp = document.getElementById('taaplay_hp');

  form.addEventListener('submit', async function(ev){
    ev.preventDefault();
    resp.textContent = '';

    const required = form.querySelectorAll('[required]');
    let firstInvalid = null;
    required.forEach(el => { if (!el.checkValidity() && !firstInvalid) firstInvalid = el; });
    if (firstInvalid){
      firstInvalid.reportValidity?.();
      firstInvalid.focus();
      resp.textContent = 'Please complete the required fields.';
      track('form_validation_error');
      return;
    }

    if (hp && hp.value.trim() !== '') {
      resp.textContent = 'Thanks!';
      track('spam_honeypot_blocked');
      form.reset();
      return;
    }
    if (Date.now() - pageLoadAt < 1500) {
      resp.textContent = 'Please try again.';
      track('spam_timeguard_blocked');
      return;
    }

    const payload = {
      api_key: PUBLIC_API_KEY,
      email: (form.querySelector('[name="email_address"]')?.value || '').trim(),
      fields: {
        role: form.querySelector('[name="fields[role]"]')?.value || '',
        province: form.querySelector('[name="fields[province]"]')?.value || '',
        preferred_language: form.querySelector('[name="fields[preferred_language]"]')?.value || '',
        top_need: form.querySelector('[name="fields[top_need]"]')?.value || '',
        consent: form.querySelector('[name="fields[consent]"]')?.checked ? 'true' : 'false'
      }
    };

    const btn = form.querySelector('[type="submit"]');
    const prevLabel = btn ? btn.textContent : '';
    if (btn){ btn.disabled = true; btn.textContent = 'Submitting…'; }

    try {
      track('form_submit_attempt');
      const res = await fetch(ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json; charset=utf-8' },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(()=> ({}));
      if (!res.ok) {
        const msg = data && (data.message || data.error) || `Request failed: ${res.status}`;
        throw new Error(msg);
      }

      resp.textContent = 'Success! Please check your email to confirm. Once you confirm, we’ll take you to your starter pack.';
      track('form_submit_success');
      form.reset();
      resp.scrollIntoView({ behavior: 'smooth', block: 'center' });

    } catch (err) {
      console.error('Kit subscribe error:', err);
      resp.textContent = 'Sorry—something went wrong. Please try again later or email hello@taaplay.com.';
      track('form_submit_error', { message: String(err && err.message || err) });
    } finally {
      if (btn){ btn.disabled = false; btn.textContent = prevLabel; }
    }
  }, { passive: false });
})();
</script>

</body>
</html>
